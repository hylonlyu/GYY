# GYYæœåŠ¡ç«¯ä¸ŽWeChatAutoå®¢æˆ·ç«¯é€šä¿¡åè®®æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†GYYæœåŠ¡ç«¯ä¸ŽWeChatAutoå®¢æˆ·ç«¯ä¹‹é—´çš„TCPé€šä¿¡åè®®ã€æ¶ˆæ¯æ ¼å¼å’ŒåŠŸèƒ½å®žçŽ°ã€‚

## ç³»ç»Ÿæž¶æž„

- **æœåŠ¡ç«¯**: GYY (.NET Framework 4.8)
- **å®¢æˆ·ç«¯**: WeChatAuto (.NET Framework 4.7.2)
- **é€šä¿¡åè®®**: TCP
- **ç¼–ç æ ¼å¼**: UTF-8

## ðŸ–¥ï¸ æœåŠ¡ç«¯ (GYY) é€šä¿¡åŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½

#### 1. TCPæœåŠ¡å™¨ç®¡ç†
- ç›‘å¬æŒ‡å®šç«¯å£ (é»˜è®¤9000)
- æ”¯æŒå¤šå®¢æˆ·ç«¯å¹¶å‘è¿žæŽ¥
- å¼‚æ­¥æŽ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯
- å®žæ—¶ç›‘æŽ§æœåŠ¡å™¨è¿è¡ŒçŠ¶æ€

#### 2. æ¶ˆæ¯å¤„ç†
- **å¿ƒè·³å“åº”**: æŽ¥æ”¶ `HEARTBEAT` â†’ å›žå¤ `HEARTBEAT_ACK`
- **æ—¥å¿—è®°å½•**: è®°å½•æ‰€æœ‰æ”¶å‘æ¶ˆæ¯
- **æ¶ˆæ¯è½¬å‘**: å°†æ¶ˆæ¯å‘é€ç»™æŒ‡å®šå®¢æˆ·ç«¯æˆ–å¹¿æ’­æ‰€æœ‰å®¢æˆ·ç«¯
- **é”™è¯¯å¤„ç†**: å¤„ç†ç½‘ç»œå¼‚å¸¸å’Œå®¢æˆ·ç«¯æ–­å¼€

#### 3. å®¢æˆ·ç«¯ç®¡ç†
- è¿žæŽ¥çŠ¶æ€å®žæ—¶ç›‘æŽ§
- å®¢æˆ·ç«¯åˆ—è¡¨åŠ¨æ€æ›´æ–°
- æ‰‹åŠ¨æ–­å¼€æŒ‡å®šå®¢æˆ·ç«¯è¿žæŽ¥
- è¿žæŽ¥ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º

#### 4. UIäº¤äº’åŠŸèƒ½
- å¯åŠ¨/åœæ­¢TCPæœåŠ¡å™¨
- é€‰æ‹©å®¢æˆ·ç«¯å‘é€å•ç‚¹æ¶ˆæ¯
- å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰å®¢æˆ·ç«¯
- æ¸…ç©ºè°ƒè¯•æ—¥å¿—çª—å£
- å®žæ—¶æ˜¾ç¤ºæœåŠ¡å™¨çŠ¶æ€å’Œè¿žæŽ¥æ•°

### å…³é”®æ–‡ä»¶
- `TcpServer.cs`: TCPæœåŠ¡å™¨æ ¸å¿ƒå®žçŽ°
- `FrmGuaDan.cs`: ä¸»ç•Œé¢å’Œé€šä¿¡é€»è¾‘
- `HttpMessageServer.cs`: HTTPæ¶ˆæ¯æœåŠ¡å™¨(å¤‡ç”¨)

## ðŸ“± å®¢æˆ·ç«¯ (WeChatAuto) é€šä¿¡åŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½

#### 1. TCPå®¢æˆ·ç«¯ç®¡ç†
- è¿žæŽ¥åˆ°æŒ‡å®šæœåŠ¡å™¨IPå’Œç«¯å£
- å¼‚æ­¥æŽ¥æ”¶æœåŠ¡å™¨æ¶ˆæ¯
- è¿žæŽ¥çŠ¶æ€å®žæ—¶æ›´æ–°
- ç½‘ç»œå¼‚å¸¸è‡ªåŠ¨å¤„ç†

#### 2. å¿ƒè·³æœºåˆ¶
- å®šæ—¶å‘é€ `HEARTBEAT` (é»˜è®¤5ç§’é—´éš”)
- æ£€æµ‹ `HEARTBEAT_ACK` å“åº”
- å¿ƒè·³è¶…æ—¶æ£€æµ‹ (5ç§’)
- å¤±è´¥æ—¶è§¦å‘è‡ªåŠ¨é‡è¿žæœºåˆ¶

#### 3. æ¶ˆæ¯å¤„ç†
- æŽ¥æ”¶æœåŠ¡å™¨æŽ¨é€çš„ä¸šåŠ¡æ¶ˆæ¯
- è‡ªåŠ¨å¡«å……æ¶ˆæ¯åˆ°è¾“å…¥æ¡† (`txtMsg`)
- è§¦å‘è‡ªåŠ¨å‘é€åŠ¨ä½œ (`button1.PerformClick()`)
- è¿‡æ»¤å’Œå¤„ç†å¿ƒè·³å“åº”æ¶ˆæ¯

#### 4. è¿žæŽ¥ç®¡ç†
- è¿žæŽ¥çŠ¶æ€å®žæ—¶æ˜¾ç¤º (ç»¿è‰²=è¿žæŽ¥ï¼Œçº¢è‰²=æ–­å¼€)
- æ–­çº¿è‡ªåŠ¨é‡è¿ž (5ç§’é—´éš”)
- è¿žæŽ¥ä¸¢å¤±èµ„æºæ¸…ç†
- é‡è¿žæˆåŠŸçŠ¶æ€æ¢å¤

### å…³é”®æ–‡ä»¶
- `Form1.cs`: ä¸»ç•Œé¢å’Œå®¢æˆ·ç«¯é€šä¿¡é€»è¾‘
- `HttpMessageClient.cs`: HTTPå®¢æˆ·ç«¯(å¤‡ç”¨)

## ðŸ“¡ é€šä¿¡åè®®å’Œæ¶ˆæ¯æ ¼å¼

### åè®®åŸºç¡€
- **ä¼ è¾“åè®®**: TCP
- **ç¼–ç æ ¼å¼**: UTF-8
- **è¿žæŽ¥æ–¹å¼**: æŒä¹…è¿žæŽ¥
- **æ¶ˆæ¯è¾¹ç•Œ**: æ¯æ¡æ¶ˆæ¯ç‹¬ç«‹å‘é€ï¼Œæ— åˆ†éš”ç¬¦
- **ç¼“å†²åŒºå¤§å°**: 8192å­—èŠ‚

### æ ‡å‡†æ¶ˆæ¯æ ¼å¼

| æ¶ˆæ¯ç±»åž‹ | å‘é€æ–¹å‘ | æ¶ˆæ¯å†…å®¹ | åŠŸèƒ½è¯´æ˜Ž |
|---------|---------|----------|---------|
| **å¿ƒè·³è¯·æ±‚** | å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯ | `HEARTBEAT` | è¿žæŽ¥ä¿æ´»æ£€æµ‹ |
| **å¿ƒè·³å“åº”** | æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ | `HEARTBEAT_ACK` | å¿ƒè·³ç¡®è®¤å“åº” |
| **ä¸šåŠ¡æ¶ˆæ¯** | æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ | `ä»»æ„å­—ç¬¦ä¸²` | WeChatæ¶ˆæ¯å†…å®¹ |
| **ç®¡ç†æ¶ˆæ¯** | æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ | `ä»»æ„å­—ç¬¦ä¸²` | æŽ§åˆ¶æŒ‡ä»¤æˆ–é€šçŸ¥ |

### æ¶ˆæ¯å¤„ç†é€»è¾‘

#### æœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯
```csharp
private void OnMessageReceived(TcpServer.ClientInfo client, string message)
{
    if (message == "HEARTBEAT")
    {
        // å¿ƒè·³æ¶ˆæ¯ï¼Œå›žå¤ç¡®è®¤
        bool success = tcpServer.TrySendToClient(client.Id, "HEARTBEAT_ACK");
        AppendTcpLog($"æ”¶åˆ°å¹¶å›žå¤æ¥è‡ª {client.RemoteEndPoint} çš„å¿ƒè·³");
    }
    else
    {
        // å…¶ä»–æ¶ˆæ¯ï¼Œè®°å½•æ—¥å¿—
        AppendTcpLog($"æ”¶åˆ°æ¥è‡ª {client.RemoteEndPoint} çš„æ¶ˆæ¯: {message}");
    }
}
```

#### å®¢æˆ·ç«¯æ”¶åˆ°æ¶ˆæ¯
```csharp
private void ProcessReceivedMessage(string message)
{
    if (IsHeartbeatAck(message))
    {
        HandleHeartbeatAck();  // å¤„ç†å¿ƒè·³å“åº”
    }
    else
    {
        // ä¸šåŠ¡æ¶ˆæ¯ï¼Œè‡ªåŠ¨å¤„ç†
        this.Invoke(new Action(() =>
        {
            txtMsg.Text = message;
            button1.PerformClick();  // è‡ªåŠ¨å‘é€
        }));
    }
}
```

## ðŸ”„ å®Œæ•´é€šä¿¡æµç¨‹

### 1. è¿žæŽ¥å»ºç«‹æµç¨‹
```
1. æœåŠ¡ç«¯å¯åŠ¨TCPæœåŠ¡å™¨ (ç›‘å¬ç«¯å£9000)
2. å®¢æˆ·ç«¯å¯åŠ¨å¹¶å°è¯•è¿žæŽ¥æœåŠ¡ç«¯
3. è¿žæŽ¥æˆåŠŸåŽå®¢æˆ·ç«¯å¼€å§‹å¿ƒè·³æœºåˆ¶
4. æœåŠ¡ç«¯è®°å½•å®¢æˆ·ç«¯è¿žæŽ¥ä¿¡æ¯
```

### 2. æ­£å¸¸é€šä¿¡æµç¨‹
```
é€šä¿¡å¾ªçŽ¯ (æŒç»­è¿›è¡Œ):
â”Œâ”€ å®¢æˆ·ç«¯å‘é€ HEARTBEAT (æ¯5ç§’)
â”‚  æœåŠ¡ç«¯æŽ¥æ”¶å¹¶ç«‹å³å›žå¤ HEARTBEAT_ACK
â”‚  å®¢æˆ·ç«¯æŽ¥æ”¶å¿ƒè·³å“åº”å¹¶æ›´æ–°çŠ¶æ€
â”‚  æœåŠ¡ç«¯å¯éšæ—¶å‘å®¢æˆ·ç«¯å‘é€ä¸šåŠ¡æ¶ˆæ¯
â”‚  å®¢æˆ·ç«¯æŽ¥æ”¶æ¶ˆæ¯å¹¶è‡ªåŠ¨å¤„ç†å‘é€
â””â”€
```

### 3. å¼‚å¸¸å¤„ç†æµç¨‹
```
è¿žæŽ¥æ–­å¼€å¤„ç†:
â”œâ”€ å®¢æˆ·ç«¯æ£€æµ‹åˆ°è¿žæŽ¥ä¸¢å¤±
â”œâ”€ åœæ­¢å¿ƒè·³å®šæ—¶å™¨
â”œâ”€ æ¸…ç†ç½‘ç»œèµ„æº (stream, socket)
â”œâ”€ æ›´æ–°è¿žæŽ¥çŠ¶æ€æ˜¾ç¤º (çº¢è‰²)
â”œâ”€ å¯åŠ¨è‡ªåŠ¨é‡è¿žæœºåˆ¶
â”œâ”€ é‡è¿žæˆåŠŸåŽæ¢å¤å¿ƒè·³
â””â”€ é‡è¿žå¤±è´¥æ—¶ç»§ç»­å°è¯•
```

### 4. é€šä¿¡æ—¶åºå›¾
```
å®¢æˆ·ç«¯                    æœåŠ¡ç«¯
  |                         |
  |-- å»ºç«‹TCPè¿žæŽ¥ ---------->|
  |<-- è¿žæŽ¥ç¡®è®¤ -------------|
  |                         |
  |-- HEARTBEAT ----------->|
  |<-- HEARTBEAT_ACK -------|
  |                         |
  |<-- ä¸šåŠ¡æ¶ˆæ¯ "Hello" ----|
  |   (è‡ªåŠ¨å¡«å……å¹¶å‘é€)      |
  |                         |
  |-- HEARTBEAT ----------->|
  |<-- HEARTBEAT_ACK -------|
  |                         |
```

## âš™ï¸ é…ç½®å‚æ•°

### ç½‘ç»œé…ç½®
| å‚æ•° | æœåŠ¡ç«¯ | å®¢æˆ·ç«¯ | é»˜è®¤å€¼ | è¯´æ˜Ž |
|------|-------|-------|--------|------|
| **ç›‘å¬ç«¯å£** | 9000 | - | 9000 | TCPæœåŠ¡ç›‘å¬ç«¯å£ |
| **è¿žæŽ¥ç«¯å£** | - | 9000 | 9000 | å®¢æˆ·ç«¯è¿žæŽ¥ç«¯å£ |
| **å¿ƒè·³é—´éš”** | - | 5ç§’ | 5ç§’ | å®¢æˆ·ç«¯å¿ƒè·³å‘é€é—´éš” |
| **å¿ƒè·³è¶…æ—¶** | - | 5ç§’ | 5ç§’ | å¿ƒè·³å“åº”ç­‰å¾…è¶…æ—¶ |
| **é‡è¿žé—´éš”** | - | 5ç§’ | 5ç§’ | æ–­çº¿é‡è¿žé—´éš” |
| **è¿žæŽ¥è¶…æ—¶** | - | 10ç§’ | 10ç§’ | è¿žæŽ¥å»ºç«‹è¶…æ—¶ |

### æŠ€æœ¯å‚æ•°
| å‚æ•° | å€¼ | è¯´æ˜Ž |
|------|---|------|
| **ç¼“å†²åŒºå¤§å°** | 8192å­—èŠ‚ | ç½‘ç»œæŽ¥æ”¶ç¼“å†²åŒº |
| **ç¼–ç æ ¼å¼** | UTF-8 | æ¶ˆæ¯ç¼–ç  |
| **ä¼ è¾“åè®®** | TCP | å¯é ä¼ è¾“ |
| **æœ€å¤§å®¢æˆ·ç«¯æ•°** | æ— é™åˆ¶ | å–å†³äºŽç³»ç»Ÿèµ„æº |
| **æ—¥å¿—æ¡ç›®é™åˆ¶** | 500æ¡ | UIæ˜¾ç¤ºé™åˆ¶ |

## ðŸŽ¯ ä¸»è¦ä¸šåŠ¡åœºæ™¯

### 1. æ¶ˆæ¯æŽ¨é€åœºæ™¯
```
ä¸šåŠ¡æµç¨‹:
1. æœåŠ¡ç«¯äº§ç”ŸWeChatæ¶ˆæ¯å†…å®¹
2. é€šè¿‡TCPè¿žæŽ¥æŽ¨é€ç»™æŒ‡å®šå®¢æˆ·ç«¯
3. å®¢æˆ·ç«¯æŽ¥æ”¶å¹¶è‡ªåŠ¨å¡«å……åˆ°æ¶ˆæ¯æ¡†
4. è§¦å‘è‡ªåŠ¨å‘é€åŠ¨ä½œ
5. å®ŒæˆWeChatæ¶ˆæ¯å‘é€
```

### 2. ç³»ç»Ÿç®¡ç†åœºæ™¯
```
ç®¡ç†åŠŸèƒ½:
- å®žæ—¶æŸ¥çœ‹æ‰€æœ‰å®¢æˆ·ç«¯è¿žæŽ¥çŠ¶æ€
- å•ç‹¬å‘æŸä¸ªå®¢æˆ·ç«¯å‘é€æŽ§åˆ¶æŒ‡ä»¤
- å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰å®¢æˆ·ç«¯
- æ‰‹åŠ¨æ–­å¼€å¼‚å¸¸å®¢æˆ·ç«¯è¿žæŽ¥
- ç›‘æŽ§ç³»ç»Ÿé€šä¿¡æ—¥å¿—
```

### 3. æ•…éšœæ¢å¤åœºæ™¯
```
æ•…éšœå¤„ç†:
- ç½‘ç»œä¸­æ–­è‡ªåŠ¨é‡è¿ž
- æœåŠ¡é‡å¯å®¢æˆ·ç«¯è‡ªåŠ¨æ¢å¤
- å¿ƒè·³è¶…æ—¶è¿žæŽ¥é‡å»º
- å¼‚å¸¸æƒ…å†µæ—¥å¿—è®°å½•
```

## ðŸ“Š æ•°æ®æµå‘æ€»ç»“

### æœåŠ¡ç«¯æ•°æ®æµå‘
```
è¾“å…¥æ•°æ®:
â”œâ”€â”€ å®¢æˆ·ç«¯å¿ƒè·³æ¶ˆæ¯
â”œâ”€â”€ å®¢æˆ·ç«¯è¿žæŽ¥è¯·æ±‚
â””â”€â”€ UIæ“ä½œæŒ‡ä»¤

è¾“å‡ºæ•°æ®:
â”œâ”€â”€ å¿ƒè·³ç¡®è®¤å“åº”
â”œâ”€â”€ ä¸šåŠ¡æ¶ˆæ¯æŽ¨é€
â”œâ”€â”€ å®¢æˆ·ç«¯ç®¡ç†æŒ‡ä»¤
â””â”€â”€ çŠ¶æ€æ—¥å¿—ä¿¡æ¯
```

### å®¢æˆ·ç«¯æ•°æ®æµå‘
```
è¾“å…¥æ•°æ®:
â”œâ”€â”€ æœåŠ¡ç«¯å¿ƒè·³ç¡®è®¤
â”œâ”€â”€ æœåŠ¡ç«¯ä¸šåŠ¡æ¶ˆæ¯
â””â”€â”€ ç½‘ç»œçŠ¶æ€å˜åŒ–

è¾“å‡ºæ•°æ®:
â”œâ”€â”€ å®šæ—¶å¿ƒè·³è¯·æ±‚
â”œâ”€â”€ è¿žæŽ¥çŠ¶æ€æ›´æ–°
â””â”€â”€ WeChatæ¶ˆæ¯å‘é€
```

## ðŸ”§ æŠ€æœ¯ç‰¹ç‚¹

### ä¼˜åŠ¿
- **å®žæ—¶æ€§å¼º**: TCPæŒä¹…è¿žæŽ¥ï¼Œä½Žå»¶è¿Ÿé€šä¿¡
- **å¯é æ€§é«˜**: å†…ç½®å¿ƒè·³å’Œé‡è¿žæœºåˆ¶
- **ç®€å•ç›´æŽ¥**: çº¯æ–‡æœ¬æ¶ˆæ¯ï¼Œæ˜“äºŽè°ƒè¯•å’Œç»´æŠ¤
- **æ‰©å±•æ€§å¥½**: æ¶ˆæ¯æ ¼å¼çµæ´»ï¼Œæ˜“äºŽæ·»åŠ æ–°åŠŸèƒ½
- **ç¨³å®šæ€§å¥½**: å¼‚å¸¸å¤„ç†å®Œå–„ï¼Œè‡ªåŠ¨æ¢å¤æœºåˆ¶

### æ”¹è¿›ç©ºé—´
- **æ¶ˆæ¯æ ¼å¼**: å¯è€ƒè™‘JSONæ ¼å¼å¢žåŠ ç»“æž„åŒ–
- **å®‰å…¨æ€§**: å¯æ·»åŠ æ¶ˆæ¯åŠ å¯†å’Œè®¤è¯æœºåˆ¶
- **æ€§èƒ½**: å¯æ·»åŠ æ¶ˆæ¯åŽ‹ç¼©å’Œæ‰¹é‡å¤„ç†
- **ç›‘æŽ§**: å¯å¢žåŠ æ€§èƒ½æŒ‡æ ‡å’Œç»Ÿè®¡åˆ†æž

## ðŸ“ ç‰ˆæœ¬åŽ†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜Ž |
|------|------|------|
| v1.0 | 2024-12-17 | åˆå§‹ç‰ˆæœ¬ï¼ŒTCPé€šä¿¡åè®®å®žçŽ° |
| | | å¿ƒè·³ä¿æ´»æœºåˆ¶ |
| | | è‡ªåŠ¨é‡è¿žåŠŸèƒ½ |
| | | åŸºç¡€æ¶ˆæ¯æŽ¨é€ |

---

**æ–‡æ¡£ç»´æŠ¤**: å¼€å‘å›¢é˜Ÿ
**æœ€åŽæ›´æ–°**: 2024-12-17